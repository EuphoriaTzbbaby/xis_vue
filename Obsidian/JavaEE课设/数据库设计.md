以下是符合Markdown格式的详细数据库设计文档，适合用于项目或课程设计文档：

---

## 📂 数据库设计

### 1. 概述

本系统的数据库设计围绕评论管理和情感分析展开，主要包含以下几个表：

- **notes**：用于存储话题信息。
    
- **note_comments**：存储每个话题下的评论。
    
- **comment_sentiment_analysis**：存储评论的情感分析结果。
    
- **operation_logs**：记录管理员操作日志。
    

### 2. 数据库表设计

#### 2.1 `notes` 表（话题表）

用于存储系统中所有话题的信息，包括话题的唯一标识符、标题、URL 等。

```sql
CREATE TABLE `notes`  (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `note_id` VARCHAR(64) NOT NULL,                -- 话题唯一标识符
  `title` VARCHAR(255) NOT NULL,                  -- 话题标题
  `url` TEXT NOT NULL,                            -- 话题链接
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,  -- 创建时间
  PRIMARY KEY (`id`),
  UNIQUE INDEX `note_id` (`note_id`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci;
```

**字段说明**：

|字段名|类型|描述|
|---|---|---|
|`id`|BIGINT|自增主键|
|`note_id`|VARCHAR(64)|话题的唯一标识符|
|`title`|VARCHAR(255)|话题标题|
|`url`|TEXT|话题的URL链接|
|`created_at`|TIMESTAMP|话题创建时间|

#### 2.2 `note_comments` 表（评论表）

用于存储每个话题下的评论信息。每条评论包括评论内容、用户信息、点赞数等。

```sql
CREATE TABLE `note_comments`  (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `note_id` VARCHAR(64) NOT NULL,                -- 话题ID，外键
  `comment_id` VARCHAR(64) NOT NULL,             -- 评论ID
  `user_id` VARCHAR(64) DEFAULT NULL,            -- 用户ID
  `nickname` VARCHAR(64) DEFAULT NULL,           -- 用户昵称
  `gender` VARCHAR(8) DEFAULT NULL,              -- 用户性别
  `ip_location` VARCHAR(128) DEFAULT NULL,       -- 用户IP所在地
  `content` TEXT,                                -- 评论内容
  `like_count` INT DEFAULT 0,                    -- 点赞数
  `level` VARCHAR(8) DEFAULT NULL,               -- 评论等级（如普通、VIP等）
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,  -- 评论创建时间
  PRIMARY KEY (`id`),
  UNIQUE KEY `uniq_comment_id` (`comment_id`),
  INDEX `note_id` (`note_id`),
  CONSTRAINT `note_comments_ibfk_1` FOREIGN KEY (`note_id`) REFERENCES `notes` (`note_id`) ON DELETE CASCADE
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci;
```

**字段说明**：

|字段名|类型|描述|
|---|---|---|
|`id`|BIGINT|自增主键|
|`note_id`|VARCHAR(64)|话题ID，关联 `notes` 表|
|`comment_id`|VARCHAR(64)|评论ID，唯一标识每个评论|
|`user_id`|VARCHAR(64)|用户ID|
|`nickname`|VARCHAR(64)|用户昵称|
|`gender`|VARCHAR(8)|用户性别|
|`ip_location`|VARCHAR(128)|用户IP所在地|
|`content`|TEXT|评论内容|
|`like_count`|INT|点赞数|
|`level`|VARCHAR(8)|评论等级（如普通、VIP等）|
|`created_at`|TIMESTAMP|评论创建时间|

#### 2.3 `comment_sentiment_analysis` 表（评论情感分析表）

用于存储对每条评论的情感分析结果，包括情感类别和情感得分。

```sql
CREATE TABLE `comment_sentiment_analysis` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `comment_id` VARCHAR(64) NOT NULL,              -- 外键：评论ID
  `sentiment` VARCHAR(16) NOT NULL,               -- 情感类别：positive / negative / neutral
  `score` DECIMAL(5,4) NOT NULL,                  -- 情感得分：如0.8421（置信度）
  `analyzed_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,  -- 分析时间
  PRIMARY KEY (`id`),
  UNIQUE KEY `uniq_comment_id` (`comment_id`),
  CONSTRAINT `fk_comment_sentiment` FOREIGN KEY (`comment_id`) REFERENCES `note_comments` (`comment_id`) ON DELETE CASCADE
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci;
```

**字段说明**：

|字段名|类型|描述|
|---|---|---|
|`id`|BIGINT|自增主键|
|`comment_id`|VARCHAR(64)|关联 `note_comments.comment_id`|
|`sentiment`|VARCHAR(16)|情感类别（positive / negative / neutral）|
|`score`|DECIMAL(5,4)|情感得分|
|`analyzed_at`|TIMESTAMP|情感分析时间|

#### 2.4 `operation_logs` 表（管理员操作日志表）

记录管理员在后台进行的操作，如删除评论、添加话题等。

```sql
CREATE TABLE `operation_logs` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `admin_id` BIGINT NOT NULL,                     -- 管理员ID
  `action` VARCHAR(255) NOT NULL,                  -- 动作描述（如删除评论、添加话题等）
  `target_id` VARCHAR(64) DEFAULT NULL,           -- 操作目标ID（如评论ID或话题ID）
  `target_type` VARCHAR(32) DEFAULT NULL,         -- 操作目标类型（如 comment 或 note）
  `timestamp` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,  -- 操作时间
  PRIMARY KEY (`id`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4;
```

**字段说明**：

|字段名|类型|描述|
|---|---|---|
|`id`|BIGINT|自增主键|
|`admin_id`|BIGINT|管理员ID|
|`action`|VARCHAR(255)|管理员执行的操作（如删除评论等）|
|`target_id`|VARCHAR(64)|操作的目标ID（如评论ID、话题ID）|
|`target_type`|VARCHAR(32)|操作的目标类型（如 `comment` 或 `note`）|
|`timestamp`|TIMESTAMP|操作的时间|

### 3. 数据库关系

- **`note_comments`** 表通过 `note_id` 字段关联 **`notes`** 表，表示评论属于某个话题。
    
- **`comment_sentiment_analysis`** 表通过 `comment_id` 外键关联 **`note_comments`** 表，用于存储评论的情感分析结果。
    
- **`operation_logs`** 表记录管理员的操作日志，关联管理员ID、操作类型和目标ID。
    


![[graphviz (3).png]]
